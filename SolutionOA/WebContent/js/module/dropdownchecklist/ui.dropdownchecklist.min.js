(function(e){e.widget("ui.dropdownchecklist",{_appendDropContainer:function(){var a=e("<div/>");a.addClass("ui-dropdownchecklist-dropcontainer-wrapper");a.css({position:"absolute",left:"-3300",top:"-3300px",width:"3000px",height:"3000px"});var b=e("<div/>");b.addClass("ui-dropdownchecklist-dropcontainer").css("overflow-y","auto");a.append(b);e(document.body).append(a);a.drop=!1;return a},_appendControl:function(){var a=this,b=this.sourceSelect,d=e("<span/>");d.addClass("ui-dropdownchecklist-wrapper");
d.css({display:"inline-block",cursor:"default"});var c=e("<span/>");c.addClass("ui-dropdownchecklist");c.css({display:"inline-block"});d.append(c);var f=e("<span/>");f.addClass("ui-dropdownchecklist-text");f.css({display:"inline-block",overflow:"hidden"});c.append(f);d.hover(function(){a.disabled||c.toggleClass("ui-dropdownchecklist-hover")},function(){a.disabled||c.toggleClass("ui-dropdownchecklist-hover")});d.click(function(b){a.disabled||(b.stopPropagation(),a._toggleDropContainer())});d.insertAfter(b);
f.css("height",c.height());return d},_createDropItem:function(a,b,d,c,f){var h=this,g=e("<div/>");g.addClass("ui-dropdownchecklist-item");g.css({whiteSpace:"nowrap"});var i=e('<input type="checkbox"'+(c?' checked="checked"':"")+"/>").attr("index",a).val(b);g.append(i);a=e("<span/>");a.addClass("ui-dropdownchecklist-text").css({cursor:"default",width:"100%"}).text(d);f&&g.addClass("ui-dropdownchecklist-indent");g.append(a);g.hover(function(){g.addClass("ui-dropdownchecklist-item-hover")},function(){g.removeClass("ui-dropdownchecklist-item-hover")});
i.click(function(a){a.stopPropagation();h._syncSelected(e(this))});d=function(a){a.stopPropagation();a=i.attr("checked");i.attr("checked",!a);h._syncSelected(i)};a.click(d);g.click(d);return g},_createGroupItem:function(a){var b=e("<div />");b.addClass("ui-dropdownchecklist-group");b.css({whiteSpace:"nowrap"});var d=e("<span/>");d.addClass("ui-dropdownchecklist-text").css({cursor:"default",width:"100%"}).text(a);b.append(d);return b},_appendItems:function(){var a=this,b=this.sourceSelect,d=this.dropWrapper.find(".ui-dropdownchecklist-dropcontainer");
d.css({"float":"left"});b.children("optgroup").each(function(){var b=e(this),c=b.attr("label"),c=a._createGroupItem(c);d.append(c);a._appendOptions(b,d,!0)});a._appendOptions(b,d,!1);var b=d.outerWidth(),c=d.outerHeight();d.css({"float":""});return{width:b,height:c}},_appendOptions:function(a,b,d){var c=this;a.children("option").each(function(a){var h=e(this),g=h.text(),i=h.val(),h=h.attr("selected"),a=c._createDropItem(a,i,g,h,d);b.append(a)})},_syncSelected:function(a){var b=this.options,d=this.dropWrapper,
c=this.sourceSelect.get(0).options,f=d.find("input.active");if("exclusive"==b.firstItemChecksAll)if(null==a&&e(c[0]).prop("selected"))f.prop("checked",!1),e(f[0]).prop("checked",!0);else if(null!=a&&0==a.attr("index"))b=a.prop("checked"),f.prop("checked",!1),e(f[0]).prop("checked",b);else{var h=!0,g=null;f.each(function(a){0<a?e(this).prop("checked")||(h=!1):g=e(this)});null!=g&&(h&&f.prop("checked",!1),g.prop("checked",h))}else b.firstItemChecksAll&&(null==a&&e(c[0]).prop("selected")?f.prop("checked",
!0):null!=a&&0==a.attr("index")?f.prop("checked",a.prop("checked")):(h=!0,g=null,f.each(function(a){0<a?e(this).prop("checked")||(h=!1):g=e(this)}),null!=g&&g.prop("checked",h)));var i=0,f=d.find("input");f.each(function(a){var b=e(c[a+i]),d=b.html();if(null==d||""==d)i+=1,b=e(c[a+i]);b.prop("selected",e(this).prop("checked"))});this._updateControlText();null!=a&&a.focus()},_updateControlText:function(){var a=this.sourceSelect,b=this.options,d=this.controlWrapper,c=a.children("option:first"),c=null!=
c&&c.attr("selected"),a=this._formatText(a.children("option"),b.firstItemChecksAll,c),d=d.find(".ui-dropdownchecklist-text");d.text(a);d.attr("title",a)},_formatText:function(a,b,d){var c;if(e.isFunction(this.options.textFormatFunction))try{c=this.options.textFormatFunction(a)}catch(f){alert("textFormatFunction failed: "+f)}else b&&null!=d&&d.prop("selected")?c=d.html():(c="",a.each(function(){if(e(this).prop("selected")){""!=c&&(c+=", ");var a=e(this).attr("style"),b=e("<span/>");b.html(e(this).html());
null==a?c+=b.html():(b.attr("style",a),c+=e("<span/>").append(b).html())}}),""==c&&(c=null!=this.options.emptyText?this.options.emptyText:"&nbsp;"));return c},_toggleDropContainer:function(){var a=function(){var b=e.ui.dropdownchecklist.drop;null!=b&&(b.dropWrapper.css({top:"-3300px",left:"-3300px"}),b.controlWrapper.find(".ui-dropdownchecklist").toggleClass("ui-dropdownchecklist-active"),b.dropWrapper.drop=!1,e.ui.dropdownchecklist.drop=null,e(document).unbind("click",a))};this.dropWrapper.drop?
a(this):(null!=e.ui.dropdownchecklist.drop&&a(),this.dropWrapper.css({top:this.controlWrapper.offset().top+this.controlWrapper.outerHeight()+"px",left:this.controlWrapper.offset().left+"px"}),this.controlWrapper.find(".ui-dropdownchecklist").toggleClass("ui-dropdownchecklist-active"),this.dropWrapper.drop=!0,e.ui.dropdownchecklist.drop=this,e(document).bind("click",a))},_setSize:function(a){var b=this.options,d=this.dropWrapper,c=this.controlWrapper,f;if(b.width)f=parseInt(b.width);else{f=a.width;
var h=b.minWidth;f<h&&(f=h)}c.find(".ui-dropdownchecklist-text").css({width:f+"px"});c=c.outerWidth();b=null!=b.maxDropHeight?parseInt(b.maxDropHeight):-1;b=0<b&&a.height>b?b:a.height;a=a.width<c?c:a.width;e(d).css({width:a+"px",height:b+"px"});d.find(".ui-dropdownchecklist-dropcontainer").css({height:b+"px"})},_init:function(){var a=this.element;this.initialDisplay=a.css("display");a.css("display","none");this.initialMultiple=a.attr("multiple");a.attr("multiple","multiple");this.sourceSelect=a;var b=
this._appendDropContainer();this.dropWrapper=b;var d=this._appendItems(),c=this._appendControl();this.controlWrapper=c;this._updateControlText(c,b,a);this._setSize(d)},enable:function(){this.controlWrapper.find(".ui-dropdownchecklist").removeClass("ui-dropdownchecklist-disabled");this.disabled=!1},disable:function(){this.controlWrapper.find(".ui-dropdownchecklist").addClass("ui-dropdownchecklist-disabled");this.disabled=!0},destroy:function(){e.widget.prototype.destroy.apply(this,arguments);this.sourceSelect.css("display",
this.initialDisplay);this.sourceSelect.attr("multiple",this.initialMultiple);this.controlWrapper.unbind().remove();this.dropWrapper.remove()}});e.extend(e.ui.dropdownchecklist,{defaults:{width:null,maxDropHeight:null,firstItemChecksAll:!1,minWidth:50}})})(jQuery);